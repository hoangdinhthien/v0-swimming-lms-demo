NOTES:

FIX UI:

- sửa lại lịch & thêm auto xếp lịch trong lịch (fix lại auto xếp lịch), thêm thông báo/notes rằng hồ bơi quá tải ==> done

- thêm logic button 'Thêm vào lớp học' trang manager/student detail, xài api add-student (check xem có order hay ch)

- thêm logic button 'Phân công lớp học mới' trang manager/instructor detail

- thêm logic button 'Xem lịch dạy' trang manager/instructor detail

- sửa find common: searchOr (done classes & orders)

- làm phần certifcate: vô bảng certificate review, cái đó là cái frame thôi nha fe lấy thông tin user hiện ra

- làm phần data-review: xong manager, ch xong staff

- thêm select all trong quản lý học viên ==> done

- sửa form_judge lại cho user friendly, hiện tại đang quá kỹ thuật, thêm field mẫu sẵn ==> semi done

- sửa lại searchOr trong order: đang không hiện lên UI => done

- check lại UI của staff: nếu ko có permission thì vẫn phải login đc vào system nhưng ko cho xem j hết

- vẽ diagram source code folder


- xem lịch học của member => done
- xem lịch dạy của instructor => done
- update order || tạo order => done
- thêm nút refresh vào trang orders giống các trang còn lại => done
- thêm thông báo/toast cho staff có noReview: false


BÂY GIỜ TÔI CẦN BẠN SỬA LẠI LOGIC CỦA TÍNH NĂNG AUTO SCHEDULE CLASS (TỰ ĐỘNG XẾP LỊCH HỌC CHO 1 LỚP HỌC)

- đầu tiên: trước khi tự động xếp lịch học, bạn phải cần xác định được ngày hôm nay là ngày THỨ MẤY TRONG TUẦN? 
- để biết được hôm nay là ngày thứ mấy trong tuần () thì làm bằng cách code mẫu này: 
    // lấy ngày hiện tại 
    const today = new Date(); // 
    const dayOfWeek = today.getDay();
    // 0 = Chủ Nhật
    // 1 = Thứ 2
    // 2 = Thứ 3
    // ...
    // 6 = Thứ 7
- đây sẽ là MẶC ĐỊNH cho các ngày trong tuần TRÊN UI: chủ nhật= 0, t2 = 1, t3 = 2, t4 = 3, t5 = 4, t6 = 5, t7 = 6
- sau khi bạn xác định được ngày hiện tại là ngày nào rồi, thì sau đó sẽ áp dụng theo logic ở bảng ví dụ dưới đây ĐỂ CÓ THỂ GÁN CÁC NGÀY TRONG TUẦN VÀO TRONG FIELD 'array_number_in_week':
Hôm nay |   Thứ 2       |    Thứ 7      |     Chủ Nhật        | array_number_in_week
---------------------------------------------------------------------------
T2 (1)  | 1-1=0      | 6-1=5      | 0-1=-1→6      | [0, 5, 6]
T4 (3)  | 1-3= -2 → 5   | 6-3=3      | 0-3=-3→4      | [3, 4, 5]
T7 (6)  | 1-6=-5→2   | 6-6=0      | 0-6=-6→1      | [0, 1, 2]
CN (0)  | 1-0=1      | 6-0=6      | 0-0=0         | [0, 1, 6]
- ví dụ: tính được rằng hôm nay là thứ 6 => thứ 6 = 0 => sau đó dựa vào bảng ví dụ để tính được 'array_number_in_week' cần phải bỏ vào request body của api auto xếp lịch 

==============================================================

- LÀM UI KHÔNG ĐƯỢC MÀU MÈ, BỚT MÀU MÈ LẠI, BỚT ICON, UI ĐƠN GIẢN VÀ HIỆN NHỮNG THÔNG TIN MANAGER/STAFF CẦN XEM, UI HIỆN TẠI NHÌN NHƯ DÀNH CHO TRẺ CON VẬY CHẢ GIỐNG VỚI HỆ THỐNG TRANG QUẢN LÝ!! (QUAN TRỌNG NHẤT LÀ CLASS & COURSE) (LÀM UI CHO TƯỜNG MINH)

*COURSE & LỊCH (ƯU TIÊN)

- lịch: tự động xếp lịch: làm UI rõ ràng hơn, cho chọn nhiều lớp hoặc một lớp khi tự động xếp lịch, nút 'Tiếp tục' trong modal chọn lớp khi tự động xếp lịch đang vô dụng

- lịch: tạo nhiều khóa học và xếp lịch cho nhiều lớp cùng 1 lúc trong lịch

- lịch: thêm logic cho drawer trong lịch khi tạo chỉnh sửa/thêm lớp học vào lịch
    - chọn theo thứ tự, sau đó rồi mới cho chọn tiếp: chọn khung giờ + lớp học trước sau đó mới cho chọn các thứ còn lại (tính logic để show ra hồ bơi thích hợp này kia... sau khi cho chọn khung giờ + lớp học xong)
    - chỉ cho chọn giáo viên nếu lớp chưa có giáo viên, nếu lớp có giáo viên rồi thì hiện thẳng tên của giáo viên đó trong phần chọn luôn

- course: xóa phần 'xem schema' trong create course & edit course => done

- course: form judge: làm UI cho na ná của gg form, hiện tại nhìn vào đang không hiểu gì hết (kể cả khi view course detail, create course, edit)

- class: thông tin lớp học trong class detail: hiện tên thôi (làm UI tường minh)


*ORDER
- thêm logic refund: manager gọi api refund

quy định độ tuổi: gắn vs hồ pơi để validate
pool có type of age: check với tuổi của student để thao tác lịch
khi tạo user mới sẽ required birthday

- thêm search + filter khi xếp lịch
- logic thứ tự cho auto xếp lịch + tạo lớp: course -> khung giờ -> get schedule của instructor đó ra và check để chọn instructor -> tên class (generate tên class dựa theo course và slot) (UI: sẽ cho chọn theo slot -> chọn từ slot nào đến slot nào để suy ra  được min_time và max_time)


- đây là logic và các thứ tự: manager/staff sẽ chọn course và khung giờ học trước tiên -> sau đó là sẽ generate tên class dựa theo mã cho dễ xác định (generate theo tên class dựa theo course và slot) -> sau đó là sẽ chọn instructor và get schedule của instructor đó ra và check xem là các lịch hiện tại của instructor đó có phù hợp hay không (instructor có available trong khung giờ đó không) để chọn instructor cho phù hợp 

- lưu ý ở phần logic 'manager/staff sẽ chọn course và khung giờ học trước tiên': ở phần chọn Khung giờ học, hiện tại trên UI đang để cho manager/staff tự chọn các field min_time và max_time. bây giờ sẽ không cho làm như vậy nữa mà sẽ phải dựa vào thông tin của slots mà manager/staff chọn để mà calculate ra được min_time và max_time cho đúng, ví dụ khi tạo lớp học và xếp lịch tự động manager/staff chọn slot từ slot 1 đến slot 5 (từ 7 giờ đến 11 giờ) thì mình phải dựa vào đó mà tính ra được min_time và max_time. Còn về phần chọn ngày học thì sẽ giữ như cũ.
- CÓ THẮC MĂC GÌ THÌ CỨ HỎI TÔI

(UI: sẽ cho chọn theo slot -> chọn từ slot nào đến slot nào để suy ra  được min_time và max_time)

Manager:
- Khi tạo một lớp học cần support user có thể lựa chọn được instructor phù hợp cho khóa học của lớp học đó
- Khi xếp lớp cần thêm các validate, warning về các trường hợp:
	1. Tránh việc một instructor được xếp lịch dạy cho hai lớp khác nhau tại một thời điểm
  	2. Tránh việc thiếu tài nguyên hồ bơi do xếp lịch vào các hồ bơi vượt quá sức đáp ứng của hồ và cùng một thời điểm
	3. Thêm ràng buộc liên quan giữa course và pool thông qua độ tuổi ( hồ bơi dành cho trẻ em, người lớn, hỗn hợp)

hover > tự động xêp lihcj hoặc tạo lớp thêm filter search

- làm theo step (vd: antd step)

preview lịch > xác nhận > tạo lớp hàng loạt
preview > xác nhận > 

LỊCH: 
-case 1: xếp lịch hàng loạt cho lớp có sẵn (manager/schedule/auto/preview)
auto xếp lịch (ko xài schedule/auto -> thay bằng api tạo lịch bình thường) -> preview lịch + warning (nếu có thông tin bị trùng: check schedule của instructor) -> xác nhận + chọn pool + validate pool (cho sửa trực tiếp) -> tạo lịch theo api tạo lịch bình thường -> done (làm theo steps)

-case 2: tạo lớp hàng loạt + case 1
tạo lớp hàng loạt (có validate các thông tin: instructor, age rule,..., course validate: hiện chi tiết instructor đó có và thiếu gì) -> chỉ hiện lên UI các lớp học vừa mới tạo (lấy các insertedId respone data khi tạo lớp học -> search[_id:equal] là được) -> case 1 -> (làm theo steps)




OK, TA SẼ TIẾP TỤC CHỈNH SỬA:
- TẠO LỚP HỌC HÀNG LOẠT: STEP 1
    . ở phần select 'Chọn khóa học *', khi tôi mở phần select đó ra và click để chọn 1 khóa học rồi, sau đó cái select NÓ KHÔNG TỰ ĐÓNG LẠI --> cần phải sửa lại phần này (pasted image 1)
    . tiếp theo, ngay dưới phần select 'Chọn khóa học *', tôi vẫn không thấy chỗ 'Độ tuổi:' hiện lên đúng thông tin (nó chỉ hiện N/A thôi) (pasted image 2). vì 'type_of_age' trong response data của course (api fetchCourses) chỉ lưu mối id thôi:
    {
        "data": [
            [
                {
                    "data": [
                        {
                            "_id": "6904cc92f2b4e2ea577cdc95",
                            "title": "Bơi Sải Cơ Bản Cho Người Lớn",
                            "slug": "bi-si-c-bn-cho-ngi-ln",
                            "description": "Rèn kỹ thuật bơi sải và hơi thở đúng chuẩn.",
                            "price": 199997,
                            "category": [
                                {
                                    "_id": "681ef0540e90714dae7a5901",
                                    "title": "Người mới bắt đầu",
                                    "created_at": "2025-05-10T13:21:08.000Z",
                                    "created_by": "6711e8a47b45b2974bd6133c",
                                    "updated_at": "2025-05-25T14:41:01.000Z",
                                    "updated_by": "6711e8a47b45b2974bd6133c",
                                    "tenant_id": "67cabc98c87dc080914265d4",
                                    "is_active": true
                                },
                                {
                                    "_id": "68f5eff0fa3a437f39fef45a",
                                    "title": "Cơ bản",
                                    "created_at": "2025-10-20T15:16:48.000Z",
                                    "created_by": "6831d35a95ac46cc9b686001",
                                    "updated_at": "2025-10-20T15:16:48.000Z",
                                    "updated_by": "6831d35a95ac46cc9b686001",
                                    "tenant_id": "67cabc98c87dc080914265d4"
                                }
                            ],
                            "session_number": 10,
                            "session_number_duration": "75 phút",
                            "detail": [
                                {
                                    "title": "Tư thế thân",
                                    "form_judge": {
                                        "type": "object",
                                        "items": {}
                                    }
                                }
                            ],
                            "media": [
                                {
                                    "_id": "691589fc0d7b87cc47afb464",
                                    "filename": "8d2f2da4-4caf-432b-a47f-d9aaad7c1271",
                                    "disk": "uploads",
                                    "mime": "image/jpeg",
                                    "size": 472412,
                                    "title": "Tổ chức giải thi bơi giao lưu dành cho học viên",
                                    "alt": "Tổ chức giải thi bơi giao lưu dành cho học viên",
                                    "tenant_id": "67cabc98c87dc080914265d4",
                                    "created_by": "6831d35a95ac46cc9b686001",
                                    "created_at": "2025-11-13T14:34:20.000Z",
                                    "updated_at": "2025-11-13T14:34:20.000Z",
                                    "is_draft": false,
                                    "__v": 0,
                                    "path": "https://pub-faf2d56f350a464f917b1de058fed3ef.r2.dev/uploads/8d2f2da4-4caf-432b-a47f-d9aaad7c1271"
                                }
                            ],
                            "is_active": true,
                            "created_at": "2025-10-31T21:49:54.000Z",
                            "created_by": "6831d35a95ac46cc9b686001",
                            "updated_at": "2025-12-04T21:27:29.000Z",
                            "updated_by": "6711e8a47b45b2974bd6133c",
                            "tenant_id": "67cabc98c87dc080914265d4",
                            "max_member": 15,
                            "type": [
                                "global"
                            ],
                            "type_of_age": [
                                "693196f612fb3088bf2a0dfe"
                            ],
                            "orders": []
                        },
                        {
                            "_id": "6904e29b40c9e1c1a13ddd33",
                            "title": "Huấn Luyện Thi Đấu Bơi Sải",
                            "slug": "hun-luyn-thi-u-bi-si",
                            "description": "Chuẩn bị kỹ thuật thi đấu phong trào, rèn tốc độ và chiến thuật.",
                            "price": 99999,
                            "category": [
                                {
                                    "_id": "6904c3589cfd48321e3c6088",
                                    "title": "Nâng cao kỹ thuật",
                                    "is_active": true,
                                    "created_at": "2025-10-31T21:10:32.000Z",
                                    "created_by": "6831d35a95ac46cc9b686001",
                                    "updated_at": "2025-10-31T21:10:32.000Z",
                                    "updated_by": "6831d35a95ac46cc9b686001",
                                    "tenant_id": "67cabc98c87dc080914265d4"
                                },
                                {
                                    "_id": "6904c36c9cfd48321e3c6089",
                                    "title": "Huấn luyện thi đấu",
                                    "is_active": true,
                                    "created_at": "2025-10-31T21:10:52.000Z",
                                    "created_by": "6831d35a95ac46cc9b686001",
                                    "updated_at": "2025-10-31T21:10:52.000Z",
                                    "updated_by": "6831d35a95ac46cc9b686001",
                                    "tenant_id": "67cabc98c87dc080914265d4"
                                }
                            ],
                            "session_number": 20,
                            "session_number_duration": "90 phút",
                            "detail": [
                                {
                                    "title": "Xuất phát",
                                    "form_judge": {
                                        "type": "object",
                                        "items": {}
                                    }
                                }
                            ],
                            "media": [
                                {
                                    "_id": "691589fc0d7b87cc47afb464",
                                    "filename": "8d2f2da4-4caf-432b-a47f-d9aaad7c1271",
                                    "disk": "uploads",
                                    "mime": "image/jpeg",
                                    "size": 472412,
                                    "title": "Tổ chức giải thi bơi giao lưu dành cho học viên",
                                    "alt": "Tổ chức giải thi bơi giao lưu dành cho học viên",
                                    "tenant_id": "67cabc98c87dc080914265d4",
                                    "created_by": "6831d35a95ac46cc9b686001",
                                    "created_at": "2025-11-13T14:34:20.000Z",
                                    "updated_at": "2025-11-13T14:34:20.000Z",
                                    "is_draft": false,
                                    "__v": 0,
                                    "path": "https://pub-faf2d56f350a464f917b1de058fed3ef.r2.dev/uploads/8d2f2da4-4caf-432b-a47f-d9aaad7c1271"
                                }
                            ],
                            "is_active": true,
                            "created_at": "2025-10-31T23:23:55.000Z",
                            "created_by": "6831d35a95ac46cc9b686001",
                            "updated_at": "2025-12-04T21:26:52.000Z",
                            "updated_by": "6711e8a47b45b2974bd6133c",
                            "tenant_id": "67cabc98c87dc080914265d4",
                            "max_member": 15,
                            "type": [
                                "global"
                            ],
                            "type_of_age": [
                                "693196f612fb3088bf2a0dfe"
                            ],
                            "orders": []
                        },
                        {
                            "_id": "69079ef9c5d0d1fc7a75e5bb",
                            "title": "Bơi Nâng Cao Tổng Hợp",
                            "slug": "bi-nng-cao-tng-hp",
                            "description": "Học viên đã qua cơ bản, tổng hợp 4 kiểu bơi chuẩn.",
                            "price": 99998,
                            "category": [
                                {
                                    "_id": "681ef03f0e90714dae7a58ec",
                                    "title": "Trẻ em",
                                    "created_at": "2025-05-10T13:20:47.000Z",
                                    "created_by": "6711e8a47b45b2974bd6133c",
                                    "updated_at": "2025-05-25T14:41:05.000Z",
                                    "updated_by": "6711e8a47b45b2974bd6133c",
                                    "tenant_id": "67cabc98c87dc080914265d4",
                                    "is_active": true
                                },
                                {
                                    "_id": "681ef0540e90714dae7a5901",
                                    "title": "Người mới bắt đầu",
                                    "created_at": "2025-05-10T13:21:08.000Z",
                                    "created_by": "6711e8a47b45b2974bd6133c",
                                    "updated_at": "2025-05-25T14:41:01.000Z",
                                    "updated_by": "6711e8a47b45b2974bd6133c",
                                    "tenant_id": "67cabc98c87dc080914265d4",
                                    "is_active": true
                                },
                                {
                                    "_id": "68f5eff0fa3a437f39fef45a",
                                    "title": "Cơ bản",
                                    "created_at": "2025-10-20T15:16:48.000Z",
                                    "created_by": "6831d35a95ac46cc9b686001",
                                    "updated_at": "2025-10-20T15:16:48.000Z",
                                    "updated_by": "6831d35a95ac46cc9b686001",
                                    "tenant_id": "67cabc98c87dc080914265d4"
                                }
                            ],
                            "session_number": 16,
                            "session_number_duration": "75 phút",
                            "detail": [
                                {
                                    "title": "Ôn kỹ thuật cơ bản",
                                    "form_judge": {
                                        "type": "object",
                                        "items": {
                                            "okela": {
                                                "type": "string",
                                                "required": false,
                                                "is_filter": false,
                                                "text_type": "short_text"
                                            }
                                        }
                                    }
                                }
                            ],
                            "media": [
                                {
                                    "_id": "691589fc0d7b87cc47afb464",
                                    "filename": "8d2f2da4-4caf-432b-a47f-d9aaad7c1271",
                                    "disk": "uploads",
                                    "mime": "image/jpeg",
                                    "size": 472412,
                                    "title": "Tổ chức giải thi bơi giao lưu dành cho học viên",
                                    "alt": "Tổ chức giải thi bơi giao lưu dành cho học viên",
                                    "tenant_id": "67cabc98c87dc080914265d4",
                                    "created_by": "6831d35a95ac46cc9b686001",
                                    "created_at": "2025-11-13T14:34:20.000Z",
                                    "updated_at": "2025-11-13T14:34:20.000Z",
                                    "is_draft": false,
                                    "__v": 0,
                                    "path": "https://pub-faf2d56f350a464f917b1de058fed3ef.r2.dev/uploads/8d2f2da4-4caf-432b-a47f-d9aaad7c1271"
                                }
                            ],
                            "is_active": true,
                            "created_at": "2025-11-03T01:12:09.000Z",
                            "created_by": "6831d35a95ac46cc9b686001",
                            "updated_at": "2025-12-10T15:57:55.000Z",
                            "updated_by": "6711e8a47b45b2974bd6133c",
                            "tenant_id": "67cabc98c87dc080914265d4",
                            "max_member": 25,
                            "type": [
                                "global"
                            ],
                            "type_of_age": [
                                "69319672068928286b329e4a"
                            ],
                            "orders": []
                        }
                    ],
                    "meta_data": {
                        "count": 3,
                        "page": 1,
                        "limit": 100
                    }
                }
            ]
        ],
        "message": "Success",
        "statusCode": 200
    }
    . nên bạn PHẢI sử dụng api fetchAgeRules kèm với PARAM 'search[_id:equal] = ID CỦA AGE RULE ĐÓ' ĐỂ CÓ THỂ SEARCH RA ĐƯỢC AGE RULE ĐÓ (ĐỌC LẠI search-query.document.md VÀ CÁC FILE API MÀ ĐANG SỬ DỤNG FINDCOMMON KHÁC ĐỂ BIẾT THÊM).
    . api sẽ như thế này: https://n4romoz0b1.execute-api.ap-southeast-1.amazonaws.com/dev/api/v1/workflow-process/manager/age-rules?search[_id:equal]=693196f612fb3088bf2a0dfe
    . HIỂU CHỨ?

- TẠO LỚP HỌC HÀNG LOẠT: STEP 2 
    . tương tự việc gọi api để lấy được age type 'type_of_age' trong data của course Ở TRÊN
    . ở step 2 này, trên UI tôi để ý thấy phần warning độ tuổi vẫn còn hiện id như thế này 'Độ tuổi không khớp Khóa học: [693196f612fb3088bf2a0dfe] ≠ Giáo viên: [Trẻ em]' (pasted image 3)
    . như tôi đã nói ở trên vì 'type_of_age' trong response data của course (api fetchCourses) chỉ lưu mối id thôi nên bạn PHẢI sử dụng api fetchAgeRules kèm với PARAM 'search[_id:equal] = ID CỦA AGE RULE ĐÓ' ĐỂ CÓ THỂ SEARCH RA ĐƯỢC AGE RULE ĐÓ (ĐỌC LẠI search-query.document.md VÀ CÁC FILE API MÀ ĐANG SỬ DỤNG FINDCOMMON KHÁC ĐỂ BIẾT THÊM).
    . và hãy check và xóa cái button 'Tiếp tục' ở trong footer của step 2 đi (tôi click nó chẳng làm gì cả!!) vì đã có button 'Tạo... lớp học' rồi (pasted image 4)



NHỮNG THỨ CẦN SỬA VỀ LOGIC VÀ UI CHO PHẦN MODAL 'Xếp lịch cho lớp có sẵn':

- đầu tiên, tôi đang để ý thấy có 1 lỗi UI khá là nghiêm trọng ở 'CASE 2: TẠO LỚP HÀNG LOẠT + CASE 1'
    . khi tôi đã hoàn thành 'CASE 2: TẠO LỚP HÀNG LOẠT + CASE 1' xong thì tôi có mở lại modal 'Xếp lịch cho lớp có sẵn' thì tôi thấy cái lớp học mà tôi vừa mới tạo + xếp lịch xong lại được chọn, tôi click vào để hủy chọn cũng không được luôn, tôi phải reload lại trang và mở lại thì lớp học đó mới un-select (pasted image, pasted image 2). phải check trên UI để làm sao có thể chặn được việc này


- ở step 1: khi chọn (các) lớp học để xếp lịch thì phải bắt buộc manager/staff trên UI phải chọn đầy đủ 'Ngày bắt đầu xếp lịch *' và 'Chọn ca học *' và 'Chọn ngày học trong tuần' thì mới được qua tới step 2

- Xếp lịch cho lớp có sẵn - step 2: có 2 trường hợp xảy ra:
    . TRƯỜNG HỢP ĐẤU TIÊN: khi tôi lớp học mới (ở modal tạo lớp học hàng loạt) xong rồi tiếp tục xếp lịch cho lớp đó, qua tới step 2 thì UI lịch ở step 2 nó hiện lên QUÁ XẤU (pasted image 3, pasted image 4)
    . TRƯỜNG HỢP THỨ HAI: khi tôi chỉ chọn xếp lịch thôi (không làm case 2), thì UI lịch ở step 2 lại hiện lên bình thường
    . CHECK KỸ LẠI PHẦN NÀY

- step 3 và 4 cũng nên để ở dạng lịch giống step 2 thay vì list, để ở list quá dài

- CÓ GÌ THẮC MẮC THÌ CỨ HỎI TÔI


